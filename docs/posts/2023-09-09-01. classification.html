<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="GC">
<meta name="dcterms.date" content="2023-09-10">

<title>Gangcheol - 01. Classification</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../posts/study/2023-08-28-Extra 00. tidydata.html" rel="next">
<link href="../posts/2023-09-09-00. Linear Regression.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Gangcheol</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://gangcheol.github.io/mysite/" rel="" target="">
 <span class="menu-text">Lecture</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://gangcheol.github.io/TI2023/" rel="" target="">
 <span class="menu-text">Tableau</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://gangcheol.github.io/mysite2/" rel="" target="">
 <span class="menu-text">DX</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://gangcheol.github.io/IA2023/" rel="" target="">
 <span class="menu-text">IA2023</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://gangcheol.github.io/ISLP2023/" rel="" target="">
 <span class="menu-text">ISLP2023</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/gangcheol/" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../posts/2023-09-09-00. Linear Regression.html">Posts</a></li><li class="breadcrumb-item"><a href="../posts/2023-09-09-01. classification.html">01. Classification</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">01. Classification</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">분류</div>
                <div class="quarto-category">로지스틱</div>
                <div class="quarto-category">예측성능</div>
                <div class="quarto-category">과적합</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>GC </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">September 10, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>About Me</strong></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Posts</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../posts/2023-09-09-00. Linear Regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">00. Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../posts/2023-09-09-01. classification.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">01. Classification</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text">Study</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../posts/study/2023-08-28-Extra 00. tidydata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Extra 00. tidydata</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../posts/study/2023-09-03-00. 단순선형회귀분석.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">00. 단순선형회귀분석</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../posts/study/2023-09-12-01. tensorflow (1).html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">01. tensorflow (1)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../posts/study/2023-09-14-02. tensorflow (2).html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">02. tensorflow (2)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../posts/study/2023-09-19-03. 경사하강법 (1).html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">03. 경사하강법 (1)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../posts/study/2023-09-21-04. 경사하강법 (2).html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">04. 경사하강법 (2)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../posts/study/2023-09-26-05. net 설계 (1).html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">05. net 설계 (1)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../posts/study/2023-09-28-06. net 설계 (2) .html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">06. net 설계 (2)</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#note-1.-과적합" id="toc-note-1.-과적합" class="nav-link active" data-scroll-target="#note-1.-과적합">Note 1. 과적합</a>
  <ul class="collapse">
  <li><a href="#ex1" id="toc-ex1" class="nav-link" data-scroll-target="#ex1">ex1</a></li>
  <li><a href="#ex2" id="toc-ex2" class="nav-link" data-scroll-target="#ex2">ex2</a></li>
  </ul></li>
  <li><a href="#note-2.-confusion-matrix" id="toc-note-2.-confusion-matrix" class="nav-link" data-scroll-target="#note-2.-confusion-matrix">Note 2. Confusion matrix</a>
  <ul class="collapse">
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">summary</a></li>
  </ul></li>
  <li><a href="#classification" id="toc-classification" class="nav-link" data-scroll-target="#classification">Classification</a>
  <ul class="collapse">
  <li><a href="#로지스틱-회귀모형" id="toc-로지스틱-회귀모형" class="nav-link" data-scroll-target="#로지스틱-회귀모형">1. 로지스틱 회귀모형</a>
  <ul class="collapse">
  <li><a href="#model-1.-이진분류" id="toc-model-1.-이진분류" class="nav-link" data-scroll-target="#model-1.-이진분류">model 1. 이진분류</a></li>
  <li><a href="#모델-추정이진-분류" id="toc-모델-추정이진-분류" class="nav-link" data-scroll-target="#모델-추정이진-분류">모델 추정(이진 분류)</a></li>
  <li><a href="#model-2.-다중분류" id="toc-model-2.-다중분류" class="nav-link" data-scroll-target="#model-2.-다중분류">model 2. 다중분류</a></li>
  </ul></li>
  <li><a href="#판별분석discriminant-analysis" id="toc-판별분석discriminant-analysis" class="nav-link" data-scroll-target="#판별분석discriminant-analysis">2. 판별분석(discriminant analysis)</a>
  <ul class="collapse">
  <li><a href="#ldalinear-discriminant-analysis" id="toc-ldalinear-discriminant-analysis" class="nav-link" data-scroll-target="#ldalinear-discriminant-analysis">(1) LDA(Linear discriminant analysis)</a></li>
  <li><a href="#qdaquadratic-discriminant-analysis" id="toc-qdaquadratic-discriminant-analysis" class="nav-link" data-scroll-target="#qdaquadratic-discriminant-analysis">(2) QDA(Quadratic discriminant analysis)</a></li>
  </ul></li>
  <li><a href="#knnk-nearest-neighbors" id="toc-knnk-nearest-neighbors" class="nav-link" data-scroll-target="#knnk-nearest-neighbors">3. KNN(K-nearest neighbors)</a></li>
  <li><a href="#summary-1" id="toc-summary-1" class="nav-link" data-scroll-target="#summary-1">summary</a></li>
  <li><a href="#naive-bayes" id="toc-naive-bayes" class="nav-link" data-scroll-target="#naive-bayes">4. Naive Bayes</a></li>
  </ul></li>
  <li><a href="#lab" id="toc-lab" class="nav-link" data-scroll-target="#lab">Lab</a>
  <ul class="collapse">
  <li><a href="#import" id="toc-import" class="nav-link" data-scroll-target="#import">import</a></li>
  <li><a href="#data-load" id="toc-data-load" class="nav-link" data-scroll-target="#data-load">data load</a></li>
  <li><a href="#correlation" id="toc-correlation" class="nav-link" data-scroll-target="#correlation">correlation</a></li>
  <li><a href="#model1.-logistic" id="toc-model1.-logistic" class="nav-link" data-scroll-target="#model1.-logistic">model1. Logistic</a>
  <ul class="collapse">
  <li><a href="#데이터셋-분할" id="toc-데이터셋-분할" class="nav-link" data-scroll-target="#데이터셋-분할">데이터셋 분할</a></li>
  <li><a href="#모델-적합" id="toc-모델-적합" class="nav-link" data-scroll-target="#모델-적합">모델 적합</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="note-1.-과적합" class="level1">
<h1>Note 1. 과적합</h1>
<p><code>-</code> 해당 책에서는 우리가 평소에 회귀분석에서 쓰던 <span class="math inline">\(\text {MSE}= \frac {SSE}{n-(p+1)}\)</span> 이라고 표현하지 않는다.</p>
<p><code>-</code> 교재에서 말하는 <span class="math inline">\(\text{MSE}\)</span>란 다음과 같다.</p>
<p><span class="math display">\[\text{MSE} = E[(\hat y - y)^2]\]</span></p>
<p><code>-</code> 즉, 예측값과 실제값의 차이를 제곱합으로 계산 후 평균을 내는것이다.</p>
<p><code>-</code> 이를 다시 나누어 보자</p>
<p><span class="math display">\[\begin {align} E[(\hat y - y)^2] &amp;= Var(\hat y) + \text {bias}^2   \\
                                                                &amp;= E[(\hat y - E(\hat y ))^2] + E[(E(\hat y) - y)^2] + Var(\varepsilon) \end {align}\]</span></p>
<p><code>-</code> <span class="math inline">\(Var(\hat y) \, \to \,\)</span> 훈련자료의 변화에 <span class="math inline">\(\hat y\)</span>가 얼마나 민감하게 반응하는가?</p>
<p><code>-</code> <span class="math inline">\(\text {bias}^2\)</span> : 실제자료를 모형으로 얼마나 가깝게 근사할 수 있는가? (만약, <span class="math inline">\(E(\hat y) = y\)</span> 일 경우 해당 추정량은 불편추정량이다.)</p>
<ul>
<li><span class="math inline">\(Var(\hat y),\,\text {bias}^2\)</span> 는 reducible error로 어떤 모델을 선택하느냐에 따라 줄일 수 있는 오차이다.</li>
</ul>
<p><code>-</code> <span class="math inline">\(Var(\varepsilon)\)</span> : 어떤 모델을 사용하건 줄일 수 없는 오차</p>
<p><code>-</code> Flexibility : 모델 복잡도 측도</p>
<ul>
<li><p>Flexibility가 높아지면 <span class="math inline">\(Var(\hat y)\)</span> 는 높아지고, <span class="math inline">\(\text {bias}\)</span>는 낮아진다. (trade-off)</p></li>
<li><p>이를 바꿔말하면 더 유연한(복잡한) 모형은 더 큰 분산을 가지고 더 단순한 모형일수록 큰 편의를 가진다.</p></li>
<li><p>훈련 데이터로 모델 적합시, <code>bias</code>를 낮추기 위해 <code>Var</code>를 높여 모델 복잡도를 지나치게 높이는 것은 좋은 선택이 아니다.</p></li>
<li><p>아래의 예시는 모형의 복잡도가 너무 높으면 <strong>평가 데이터에 대한 MSE</strong>가 오히려 과대추정되는 <strong>“과적합 문제”</strong> 를 보여주고 있다.</p></li>
</ul>
<center>
<img src="0.png" width="600">
</center>
<section id="ex1" class="level2">
<h2 class="anchored" data-anchor-id="ex1">ex1</h2>
<center>
<img src="2.png" width="600">
</center>
<p><code>-</code> 실제로 위의 원데이터는 일반적인 선형모형으로 적합해도 괜찮을 것 같다.</p>
<p><code>-</code> 왼쪽그림에서 지나치게 복잡하게 적합된 초록색 선을 살펴보자.</p>
<ul>
<li><strong>훈련 MSE(회색선)</strong> 는 3개의 모델 중 가장 낮으나, 과적합 이슈로 <strong>평가 MSE(빨간색선)</strong> 가 과대추정된 것을 볼 수 있다.</li>
</ul>
</section>
<section id="ex2" class="level2">
<h2 class="anchored" data-anchor-id="ex2">ex2</h2>
<center>
<img src="1.png" width="600">
</center>
<p><code>-</code> 위 데이터는 <code>ex1</code>과 달리 일반적인 선형회귀모형으로 적합하면 안될것 같은 느낌이 든다.</p>
<p><code>-</code> 파란색선은 중간 정도로 적합된 복잡한 모형이고, 초록색선은 지나치게 적합된 모형이다.</p>
<ul>
<li>오른쪽 그림을 살펴보면 파란색선으로 적합된 모형의 <code>Test MSE</code>가 가장 낮음을 볼 수 있다.</li>
</ul>
</section>
</section>
<section id="note-2.-confusion-matrix" class="level1">
<h1>Note 2. Confusion matrix</h1>
<p><code>-</code> 금일 챕터에서는 분류(Classification)의 관한 문제를 다룬다.</p>
<p><code>-</code> 들어가기전에 정밀도, 재현율, 정확도와 같은 예측 성능 지표를 잡고 들어가자.</p>
<center>
<img src="4.png" width="500">
</center>
<p><code>-</code> 위 데이터는 회사에서 채무를 이행한자, 아닌자에 대한 예측 모델을 만들고 결과를 정리한 표이다.</p>
<p><code>-</code> step 1. 정확도를 살펴보자</p>
<ul>
<li>정확도를 살펴보니 채무이행여부를 판단하기 위해 만든 모델이 적절하게 잘 만들어진 것 같다.</li>
</ul>
<div class="cell" data-execution_count="288">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a>((<span class="dv">9644</span> <span class="op">+</span> <span class="dv">81</span>)<span class="op">/</span><span class="dv">10000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="288">
<pre><code>0.9725</code></pre>
</div>
</div>
<center>
<img src="4.png" width="500">
</center>
<p><code>-</code> step2. 회사의 입장(재현율) : 손해를 끼칠 위험이 큰 고객들을 분별해야한다….</p>
<ul>
<li>그런데 실제 채무를 이행하지 않은 사람들은 <code>333</code>명인데 예측 모델이 채무를 이행하지 않았다고 예측한 사람은 <code>81</code> 명이다.</li>
</ul>
<div class="cell" data-execution_count="289">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="dv">81</span><span class="op">/</span><span class="dv">333</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="289">
<pre><code>0.24324324324324326</code></pre>
</div>
</div>
<center>
<img src="4.png" width="500">
</center>
<div class="cell" data-execution_count="290">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a>(<span class="dv">81</span><span class="op">/</span><span class="dv">104</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="290">
<pre><code>0.7788461538461539</code></pre>
</div>
</div>
<p><code>-</code> step3. 모델을 만든 강철의 입장(정밀도) : 내 마음을 좀 알아줘…</p>
<ul>
<li>제가 모델을 만들었는데 그래도 참이라고 예측한 것 104명 중에 실제로 84명이 채무를 불이행했거든요?? 그러니까 성과금좀 주세욥</li>
</ul>
<p><code>-</code> result : 뭐 못 배웠다고 짤리거나 그러겠지….</p>
<p><code>-</code> 시사점 : 심슨의 역설2</p>
<ol type="1">
<li><p>우리는 단순히 test 데이터에 대한 정확도로만 보고 판단하면 안된다.</p></li>
<li><p>이분법적인 사고로 정작 해결해야할 비즈니스적 문제를 놓칠수 있지 않은가?</p></li>
</ol>
<p><code>-</code> <a href="https://gangcheol.github.io/mysite/posts/Lecture/STDV/2023-05-13-8wk.html#%EC%8B%AC%EC%8A%A8%EC%9D%98-%EC%97%AD%EC%84%A4">심슨의 역설</a></p>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">summary</h2>
<p><code>1</code> 정확도 : 전체에서 예측값과 실제값이 일치하는 비율</p>
<p><code>2</code> 정밀도 : 내가 참이라고 예측한 것 중에 실제로 참인 비율 (전, 이걸 모델의 건방짐이라고 외웠습니다.)</p>
<p><code>3</code> 재현율 : 실제 참인 것들 중에서 모델이 참이라고 예측한 비율 (회사의 입장)</p>
<hr>
</section>
</section>
<section id="classification" class="level1">
<h1>Classification</h1>
<section id="로지스틱-회귀모형" class="level2">
<h2 class="anchored" data-anchor-id="로지스틱-회귀모형">1. 로지스틱 회귀모형</h2>
<p><code>-</code> 로지스틱 모형은 target 변수인 <span class="math inline">\(y\)</span>에 대한 직접적 모형화가 아닌 <span class="math inline">\(y\)</span>가 특정 법주에 포함될 확률을 모형화한다.</p>
<p><span class="math display">\[P(y=1 \,|\, \bf {X})\]</span></p>
<p><code>-</code> 임계치(threshole)를 정하고 어떤 범주에 포함될 확률이 임계치보다 높으면 <strong>0 or 1</strong>로 예측하는 분류 모형이다. (이진분류에서!)</p>
<section id="model-1.-이진분류" class="level3">
<h3 class="anchored" data-anchor-id="model-1.-이진분류">model 1. 이진분류</h3>
<p>step 1. <span class="math inline">\(P(X)\)</span> : 0과 1사이의 값으로 예측해주는 모형화 작성 <strong>(로지스틱 함수)</strong></p>
<p><span class="math display">\[P(X) = \frac {\exp (\beta_0 + \beta_{1}X)}{1+\exp (\beta_0 + \beta_{1}X) } \in  (0,1 )\]</span></p>
<p>step 2. <span class="math inline">\(\frac{P(X)}{ 1- P(X)}\)</span> : odds, 배팅을 하는 분야에서 확률 대신 많이 쓰이는 측도</p>
<p><span class="math display">\[\frac {P(X)}{ 1- P(X)} =  \exp(\beta_0 + \beta_{1} X  ),\quad  \in (0,\infty)\]</span></p>
<p>step 3. <span class="math inline">\(\log \frac {P(X)}{1-P(X)}\)</span> : 이와 같은 식을 logit이라고 하며, 해당 함수를 선형회귀처럼 작성하면 다음과 같다.</p>
<p><span class="math display">\[\log \frac {P(X)}{1-P(X)}  = \beta_0 + \beta_1 X,\quad \in (-\infty, \infty)\]</span></p>
</section>
<section id="모델-추정이진-분류" class="level3">
<h3 class="anchored" data-anchor-id="모델-추정이진-분류">모델 추정(이진 분류)</h3>
<p><code>-</code> 반응변수는 범주형 변수이나 모형을 통해 예측된 값은 확률이므로 최소제곱법 등은 정당화 되기 어려움</p>
<ul>
<li><p>최대우도추정법(maximum likelihood estimation)으로 보통 추정한다.</p></li>
<li><p>반응변수가 베르누이 (혹은 아항) 분포임을 이용하여 가능도함수를 기술함</p></li>
</ul>
<p><span class="math display">\[L = \prod_{i : y_i=1}p(x_i) \prod_{i^{\prime} : y_i^{\prime} =0}(1-p(x_i)) \]</span></p>
<ul>
<li><span class="math inline">\((\hat {\beta}_0, \hat {\beta}_1)\)</span> : 위 수식을 최대화 하는 추정치이다.</li>
</ul>
</section>
<section id="model-2.-다중분류" class="level3">
<h3 class="anchored" data-anchor-id="model-2.-다중분류">model 2. 다중분류</h3>
<p><span class="math display">\[\log \frac {P(X)}{1-P(X)}  = \beta_0 + \beta_1 X + \dots \beta_{p}X_{p},\quad \in (-\infty, \infty)\]</span></p>
<p><span class="math display">\[p(X) = \frac { \beta_0 + \beta_1 X + \dots \beta_{p}X_{p}}{1+exp\,( \beta_0 + \beta_1 X + \dots \beta_{p}X_{p})},\quad \in (0,1)\]</span></p>
<hr>
</section>
</section>
<section id="판별분석discriminant-analysis" class="level2">
<h2 class="anchored" data-anchor-id="판별분석discriminant-analysis">2. 판별분석(discriminant analysis)</h2>
<p><code>-</code> 반응변수가 셋 이상의 범주를 가질 떄, 로지스틱 모형을 확장하여 위와 같이 고려할 수 있다.</p>
<p><code>-</code> 그러나 다른 대안들의 존재로 인해 이 경우 로지스틱 모형은 폭넓게 스이지는 않는다.</p>
<p><code>-</code> 대표적인 대안 중 하나는 <strong>선형판별분석</strong>이다.</p>
<ul>
<li><p>반응변수와 예측변수들의 결합분포에 기반한 방법</p></li>
<li><p><span class="math inline">\(n\)</span>이작고 <span class="math inline">\(X\)</span>의 분포가 정규분포에 가까울 때 판별분석의 성능이 로지스틱보다 좋다.</p></li>
</ul>
<p><code>-</code> 베이즈 정리</p>
<ul>
<li><span class="math inline">\(k\)</span>번째 범주로부터 관측된 <span class="math inline">\(X\)</span>의 분포를 <span class="math inline">\(f_k(x)= P(X=x|Y =k) = P(X=x,Y =k)\)</span> 라 하고, <span class="math inline">\(\pi_k= P(Y=k)\)</span> 를 각 범주의 사전확률이라고 하면, 베이즈 정리에 의하여 다음을 얻는다.</li>
</ul>
<p><span class="math display">\[P(Y=k | X=x) = \frac{\pi_k f_k(x)}{\sum_{i=1}^{K} \pi_{i}f_{i}(x)}\]</span></p>
<section id="ldalinear-discriminant-analysis" class="level3">
<h3 class="anchored" data-anchor-id="ldalinear-discriminant-analysis">(1) LDA(Linear discriminant analysis)</h3>
<p><code>-</code> <span class="math inline">\(p=1, f_k(x)\)</span>가 정규분포임과 동시에 각 범주에 해당하는 분포의 분산은 동일하다 가정</p>
<ul>
<li><span class="math inline">\(p\)</span> 는 예측변수의 개수</li>
</ul>
<p><span class="math display">\[X \sim N(\mu_k, \sigma_k^{2})\]</span></p>
<p><code>-</code> 조건부 확률 <span class="math inline">\(P(Y=k | X=x))\)</span>를 최대화 시키는 <span class="math inline">\(k\)</span>를 찾는 것은 아래의 판별함수를 최대화하는 <span class="math inline">\(k\)</span>를 찾는 것이다.</p>
<ul>
<li><span class="math inline">\(\hat{\delta}_{k}\)</span> 를 최대화시키는 범주 <span class="math inline">\(k\)</span>로 관측치를 할당.</li>
</ul>
<p><span class="math display">\[\delta_k(x) = x \frac {\mu_k}{\sigma^2} - \frac {\mu_{k}^2}{2\sigma^2}+ \log \pi_k\]</span></p>
<p><code>-</code> <span class="math inline">\(K=2\)</span>인 경우, 분류를 위한 경계치는</p>
<p><span class="math display">\[x = \frac {\mu_1+\mu_2}{2}\]</span></p>
<center>
<img src="5.png" width="400">
</center>
<p><code>-</code> 또한, <span class="math inline">\(p=1\)</span>인 경우, LDA는 다음과 같이 베이즈 분류기를 근사하게 된다.</p>
<p><span class="math display">\[\hat {\delta}_k(x) = x \frac {\hat {\mu}_k}{\hat{\sigma}^2} - \frac {\hat{\mu}_{k}^2}{2\hat{\sigma}^2}+ \log \hat{\pi}_k\]</span></p>
<p><span class="math display">\[\hat {\mu}_k = \frac{1}{n_k} \sum_{i : y_i=k} x_i\]</span></p>
<p><span class="math display">\[\hat {\sigma}^2 = \frac{1}{n-K} \sum_{k=1}^K \sum_{i:y_i = k} (x_i - \hat {\mu}_k)^2\]</span></p>
<p><span class="math display">\[\hat {P}(Y=k) = \hat {\pi}_k  = \frac{n_k}{n}\]</span></p>
<p><code>-</code> LDA의 <code>linear</code>라는 단어는 판별함수 <span class="math inline">\(\hat {\delta}_k(x)\)</span>가 <span class="math inline">\(x\)</span>의 선형함수로 표현된다는 사실로부터 유래한다.</p>
<section id="if-p1" class="level4">
<h4 class="anchored" data-anchor-id="if-p1">if, p&gt;1?</h4>
<p><code>-</code> 예측변수가 다변량인 경우 <span class="math inline">\(k\)</span>번째 범주에서 예측변수가 다변량 정규분포를 따른다는 가정으로부터 출발한다.</p>
<p><span class="math display">\[f_k(x) \sim N(\mu_k, \Sigma)\]</span></p>
<p><code>-</code> <span class="math inline">\(p=1\)</span> 일 때와 마찬기지로 모든 범주에서 공분산 행렬 <span class="math inline">\(\sum\)</span>는 동일하다고 가정</p>
<p><span class="math display">\[\delta_k(x) = x ^{\top}{\Sigma}^{-1} {\mu_k}- \frac {1}{2} \mu_{k}^{\top}{\Sigma}^{-1}\mu_k+ \log \pi_k\]</span></p>
</section>
</section>
<section id="qdaquadratic-discriminant-analysis" class="level3">
<h3 class="anchored" data-anchor-id="qdaquadratic-discriminant-analysis">(2) QDA(Quadratic discriminant analysis)</h3>
<p><code>-</code> LDA와 다르게 각 범주를 특정하는 정규분포의 분산에 이질성을 허용한다.</p>
<p><span class="math display">\[X \sim N(\mu_k, {\Sigma}_k)\]</span></p>
<p><code>-</code> 판별함수는 다음과 같다.</p>
<p><span class="math display">\[\delta_k(x) = -\frac{1}{2}(x-\mu_k) ^{\top}{\Sigma}_{k}^{-1}(x-\mu_k)- \frac {1}{2}\log |{\Sigma}_k|\log \pi_k\]</span></p>
</section>
</section>
<section id="knnk-nearest-neighbors" class="level2">
<h2 class="anchored" data-anchor-id="knnk-nearest-neighbors">3. KNN(K-nearest neighbors)</h2>
<p><code>-</code> 조건부 확률을 인접한 <span class="math inline">\(K\)</span>개의 data points의 상대비율로 추정</p>
<p><span class="math display">\[P(y=j | X = x_0) = \frac{1}{K} \sum_{i\in N_0} I(y_i=j)\]</span></p>
<p><span class="math display">\[N_0  : x_0  \text{와 가장 가까운} K \text{개의 자료의 집합}\]</span></p>
<p><code>-</code> 위 확률을 최대로 하는 <span class="math inline">\(j\)</span>로 관측치를 분류</p>
<p><code>-</code> K의 선택이 분류기의 성능을 결정하는데 매우 핵심적인 역할을 수행한다,</p>
</section>
<section id="summary-1" class="level2">
<h2 class="anchored" data-anchor-id="summary-1">summary</h2>
<p><code>-</code> 범주가 2개일 때, LDA와 로지스틱모형은 선형적인 decision boundary를 생성한다는 측면에서 동일함</p>
<p><code>-</code> 각 범주의 분포가 정규분포로 잘 근사되는지 여부에 의해서 두 방식의 성능이 엇갈릴 수 있음</p>
<p><code>-</code> KNN은 decision boundary에 어떠한 가정도 하지 않음. 즉, decision boundary가 비선형인 경우 위 두 방식에 비해 우월성을 보임</p>
<p><code>-</code> QDA는 qudratic decision boundary를 설정한다는 면에서 KNN과 LDA 혹은 로지스틱의 중간쯤에 위치하는 방법으로 볼 수 있음</p>
<ul>
<li><strong>모든 상황에서 항상 우월한 분류기는 없다</strong></li>
</ul>
</section>
<section id="naive-bayes" class="level2">
<h2 class="anchored" data-anchor-id="naive-bayes">4. Naive Bayes</h2>
<p><code>-</code> 사실 LDA, QDA의 경우 <span class="math inline">\(X\)</span>의 확률분포가 정규분포라고 추정하는 것은 어렵다.</p>
<ol type="1">
<li><p>예측변수 <span class="math inline">\(X_j\)</span> 간의 어떠한 연관성이 있을수가 있음. 즉 독립이 아님</p></li>
<li><p>따라서 추정이 어려움, 독립이 아닐경우, 결합분포, 주변확률 분포 등등 사전, 사후 확률 계산시 고려해야할 사항들이 너무 많고 복잡함.</p></li>
<li><p>그래서 나이브 베이즈에서는 각각의 클래스안에서 예측변수들은 서로 독립이다. 라는 가정에서 출발</p></li>
<li><p><span class="math inline">\(k\)</span>번째 클래스 안에서 <span class="math inline">\(X_j\)</span>에 대한 확률분포는 다음과 같다.</p></li>
</ol>
<p><span class="math display">\[X_j|Y = k \sim N(\mu_{jk},\sigma^{2}_{jk})\]</span></p>
<p><code>-</code> 아래는 <span class="math inline">\(k\)</span>번째 클래스의 확률분포이다.</p>
<p><span class="math display">\[f_k(x) = f_{k1}(x_1) \times \dots  \times f_{kp}(x_p) \]</span></p>
<p><code>-</code> 이제 사후 확률을 계산식을 살펴보자</p>
<p><span class="math display">\[P(Y=k|X=x ) = \frac{\pi_k \times f_{k1}(x_1) \times f_{k2}(x_2) \times f_{kp}(x_p)}{\sum_{i=1}^{k}\pi_i \times f_{i1}(x_1) \times f_{i2}(x_2) \times f_{ip}(x_p) }\]</span></p>
<p><code>-</code> example : <span class="math inline">\(\pi_1= \pi_2= 0.5\)</span></p>
<p>$K=1, (<em>{11}(0.4) = 0.368, ,</em>{12}(1.5) = 0.484, , _{13}(1) = 0.226) $</p>
<p>$K=2, (<em>{21}(0.4) = 0.030, ,</em>{22}(1.5) = 0.130, , _{23}(1) = 0.616) $</p>
<p>위 공식을 이용하여 각각에 대한 사후활률을 추정하면?</p>
<div class="cell" data-execution_count="291">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a>k1<span class="op">=</span> <span class="fl">0.5</span><span class="op">*</span><span class="fl">0.368</span><span class="op">*</span><span class="fl">0.484</span><span class="op">*</span><span class="fl">0.226</span><span class="op">/</span>(<span class="fl">0.5</span><span class="op">*</span><span class="fl">0.368</span><span class="op">*</span><span class="fl">0.484</span><span class="op">*</span><span class="fl">0.226</span><span class="op">+</span> <span class="fl">0.5</span><span class="op">*</span><span class="fl">0.030</span><span class="op">*</span><span class="fl">0.130</span><span class="op">*</span><span class="fl">0.616</span>)</span>
<span id="cb7-2"><a href="#cb7-2"></a>k2 <span class="op">=</span> <span class="fl">0.5</span><span class="op">*</span><span class="fl">0.030</span><span class="op">*</span><span class="fl">0.130</span><span class="op">*</span><span class="fl">0.616</span><span class="op">/</span>(<span class="fl">0.5</span><span class="op">*</span><span class="fl">0.368</span><span class="op">*</span><span class="fl">0.484</span><span class="op">*</span><span class="fl">0.226</span><span class="op">+</span> <span class="fl">0.5</span><span class="op">*</span><span class="fl">0.030</span><span class="op">*</span><span class="fl">0.130</span><span class="op">*</span><span class="fl">0.616</span>)</span>
<span id="cb7-3"><a href="#cb7-3"></a></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="bu">print</span>(<span class="ss">f"P(y=1) =</span><span class="sc">{</span>k1 <span class="sc">: .3f}</span><span class="ss">, P(y=2) =</span><span class="sc">{</span>k2 <span class="sc">: .3f}</span><span class="ss"> "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>P(y=1) = 0.944, P(y=2) = 0.056 </code></pre>
</div>
</div>
<ul>
<li>나이브 베이즈 분류기는 확실이 LDA, QDA보다 계산이 간단하고 모델링 시 더 빠르게 수행될 것 같음</li>
</ul>
<hr>
</section>
</section>
<section id="lab" class="level1">
<h1>Lab</h1>
<section id="import" class="level2">
<h2 class="anchored" data-anchor-id="import">import</h2>
<div class="cell" data-tags="[]" data-execution_count="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="im">from</span> matplotlib.pyplot <span class="im">import</span> subplots</span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="im">from</span> ISLP <span class="im">import</span> load_data</span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="im">from</span> ISLP.models <span class="im">import</span> (ModelSpec <span class="im">as</span> MS,</span>
<span id="cb9-7"><a href="#cb9-7"></a>summarize)</span>
<span id="cb9-8"><a href="#cb9-8"></a></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="im">from</span> ISLP <span class="im">import</span> confusion_table</span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="im">from</span> ISLP.models <span class="im">import</span> contrast</span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="im">from</span> sklearn.discriminant_analysis <span class="im">import</span> <span class="op">\</span></span>
<span id="cb9-12"><a href="#cb9-12"></a>(LinearDiscriminantAnalysis <span class="im">as</span> LDA,</span>
<span id="cb9-13"><a href="#cb9-13"></a>QuadraticDiscriminantAnalysis <span class="im">as</span> QDA)</span>
<span id="cb9-14"><a href="#cb9-14"></a><span class="im">from</span> sklearn.naive_bayes <span class="im">import</span> GaussianNB</span>
<span id="cb9-15"><a href="#cb9-15"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb9-16"><a href="#cb9-16"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb9-17"><a href="#cb9-17"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb9-18"><a href="#cb9-18"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb9-19"><a href="#cb9-19"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report</span>
<span id="cb9-20"><a href="#cb9-20"></a></span>
<span id="cb9-21"><a href="#cb9-21"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb9-22"><a href="#cb9-22"></a><span class="im">import</span> plotly.io <span class="im">as</span> pio</span>
<span id="cb9-23"><a href="#cb9-23"></a>pio.renderers.default <span class="op">=</span> <span class="st">"plotly_mimetype+notebook_connected"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data-load" class="level2">
<h2 class="anchored" data-anchor-id="data-load">data load</h2>
<div class="cell" data-execution_count="293">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a>Smarket <span class="op">=</span> load_data(<span class="st">'Smarket'</span>)</span>
<span id="cb10-2"><a href="#cb10-2"></a>Smarket.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 1250 entries, 0 to 1249
Data columns (total 9 columns):
 #   Column     Non-Null Count  Dtype  
---  ------     --------------  -----  
 0   Year       1250 non-null   int64  
 1   Lag1       1250 non-null   float64
 2   Lag2       1250 non-null   float64
 3   Lag3       1250 non-null   float64
 4   Lag4       1250 non-null   float64
 5   Lag5       1250 non-null   float64
 6   Volume     1250 non-null   float64
 7   Today      1250 non-null   float64
 8   Direction  1250 non-null   object 
dtypes: float64(7), int64(1), object(1)
memory usage: 88.0+ KB</code></pre>
</div>
</div>
<div class="cell" data-execution_count="294">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a>Smarket.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="294">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Lag1</th>
<th data-quarto-table-cell-role="th">Lag2</th>
<th data-quarto-table-cell-role="th">Lag3</th>
<th data-quarto-table-cell-role="th">Lag4</th>
<th data-quarto-table-cell-role="th">Lag5</th>
<th data-quarto-table-cell-role="th">Volume</th>
<th data-quarto-table-cell-role="th">Today</th>
<th data-quarto-table-cell-role="th">Direction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2001</td>
<td>0.381</td>
<td>-0.192</td>
<td>-2.624</td>
<td>-1.055</td>
<td>5.010</td>
<td>1.1913</td>
<td>0.959</td>
<td>Up</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2001</td>
<td>0.959</td>
<td>0.381</td>
<td>-0.192</td>
<td>-2.624</td>
<td>-1.055</td>
<td>1.2965</td>
<td>1.032</td>
<td>Up</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2001</td>
<td>1.032</td>
<td>0.959</td>
<td>0.381</td>
<td>-0.192</td>
<td>-2.624</td>
<td>1.4112</td>
<td>-0.623</td>
<td>Down</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2001</td>
<td>-0.623</td>
<td>1.032</td>
<td>0.959</td>
<td>0.381</td>
<td>-0.192</td>
<td>1.2760</td>
<td>0.614</td>
<td>Up</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2001</td>
<td>0.614</td>
<td>-0.623</td>
<td>1.032</td>
<td>0.959</td>
<td>0.381</td>
<td>1.2057</td>
<td>0.213</td>
<td>Up</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><code>-</code> 해당 데이터는 2001년 부터 2005년까지 주식 데이터이다.</p>
<ul>
<li><p>Year는 해당 데이터가 관측된 년도</p></li>
<li><p>Lag1은 하루 전의 수익률</p></li>
<li><p>Lag2는 이틀 전의 수익률</p></li>
<li><p>이렇게 Lag5까지 5일 전까지의 수익률을 가지고 있다.</p></li>
<li><p>Volume은 하루에 평균적으로 몇 주가 거래되었는지</p></li>
<li><p>Today는 오늘의 수익률</p></li>
<li><p>Direction은 오늘 시장이 Up인지 Down인지 (target)</p></li>
</ul>
</section>
<section id="correlation" class="level2">
<h2 class="anchored" data-anchor-id="correlation">correlation</h2>
<div class="cell" data-execution_count="295">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a>Smarket.select_dtypes(<span class="st">"number"</span>).corr()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="295">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Lag1</th>
<th data-quarto-table-cell-role="th">Lag2</th>
<th data-quarto-table-cell-role="th">Lag3</th>
<th data-quarto-table-cell-role="th">Lag4</th>
<th data-quarto-table-cell-role="th">Lag5</th>
<th data-quarto-table-cell-role="th">Volume</th>
<th data-quarto-table-cell-role="th">Today</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Year</td>
<td>1.000000</td>
<td>0.029700</td>
<td>0.030596</td>
<td>0.033195</td>
<td>0.035689</td>
<td>0.029788</td>
<td>0.539006</td>
<td>0.030095</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Lag1</td>
<td>0.029700</td>
<td>1.000000</td>
<td>-0.026294</td>
<td>-0.010803</td>
<td>-0.002986</td>
<td>-0.005675</td>
<td>0.040910</td>
<td>-0.026155</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Lag2</td>
<td>0.030596</td>
<td>-0.026294</td>
<td>1.000000</td>
<td>-0.025897</td>
<td>-0.010854</td>
<td>-0.003558</td>
<td>-0.043383</td>
<td>-0.010250</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Lag3</td>
<td>0.033195</td>
<td>-0.010803</td>
<td>-0.025897</td>
<td>1.000000</td>
<td>-0.024051</td>
<td>-0.018808</td>
<td>-0.041824</td>
<td>-0.002448</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Lag4</td>
<td>0.035689</td>
<td>-0.002986</td>
<td>-0.010854</td>
<td>-0.024051</td>
<td>1.000000</td>
<td>-0.027084</td>
<td>-0.048414</td>
<td>-0.006900</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Lag5</td>
<td>0.029788</td>
<td>-0.005675</td>
<td>-0.003558</td>
<td>-0.018808</td>
<td>-0.027084</td>
<td>1.000000</td>
<td>-0.022002</td>
<td>-0.034860</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Volume</td>
<td>0.539006</td>
<td>0.040910</td>
<td>-0.043383</td>
<td>-0.041824</td>
<td>-0.048414</td>
<td>-0.022002</td>
<td>1.000000</td>
<td>0.014592</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Today</td>
<td>0.030095</td>
<td>-0.026155</td>
<td>-0.010250</td>
<td>-0.002448</td>
<td>-0.006900</td>
<td>-0.034860</td>
<td>0.014592</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<ul>
<li><p><code>Lag_i, todayt</code> 간 상관계수는 거의 0에 가깝다.</p></li>
<li><p>유일하게 의미가 있아보이는 상관관계는 <code>Year, Volume</code>로 계산된 <span class="math inline">\(r\)</span>이 <strong>‘0.539’</strong> 이다.</p></li>
<li><p>다시 말해서, 2001년부터 2005년까지, 하루 평균 거래량이 증가하고 있다.</p></li>
</ul>
<div class="cell" data-execution_count="296">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a>Smarket.plot( y<span class="op">=</span><span class="st">"Volume"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="296">
<pre><code>&lt;Axes: &gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2023-09-09-01. classification_files/figure-html/cell-10-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="model1.-logistic" class="level2">
<h2 class="anchored" data-anchor-id="model1.-logistic">model1. Logistic</h2>
<p><code>-</code> Lag1 ~ Lag5 까지의 변수로 금일 시장이 <code>up</code>인지 <code>down</code>인지 예측해보자.</p>
<div class="cell" data-execution_count="297">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># step 1. x,y를 저장</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>allvars <span class="op">=</span> Smarket.columns.drop([<span class="st">"Today"</span>,<span class="st">"Year"</span>,<span class="st">"Direction"</span>])</span>
<span id="cb16-3"><a href="#cb16-3"></a></span>
<span id="cb16-4"><a href="#cb16-4"></a>X <span class="op">=</span> MS(allvars).fit_transform(Smarket) </span>
<span id="cb16-5"><a href="#cb16-5"></a>y <span class="op">=</span> Smarket.Direction <span class="op">==</span> <span class="st">"Up"</span></span>
<span id="cb16-6"><a href="#cb16-6"></a></span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="co"># step 2.  모형 적합</span></span>
<span id="cb16-8"><a href="#cb16-8"></a></span>
<span id="cb16-9"><a href="#cb16-9"></a>glm <span class="op">=</span> sm.GLM(y,X , family <span class="op">=</span> sm.families.Binomial())</span>
<span id="cb16-10"><a href="#cb16-10"></a></span>
<span id="cb16-11"><a href="#cb16-11"></a><span class="co"># step 3. 모형에 대한 유의성 확인</span></span>
<span id="cb16-12"><a href="#cb16-12"></a>results <span class="op">=</span> glm.fit()</span>
<span id="cb16-13"><a href="#cb16-13"></a>results.pvalues</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="297">
<pre><code>intercept    0.600700
Lag1         0.145232
Lag2         0.398352
Lag3         0.824334
Lag4         0.851445
Lag5         0.834998
Volume       0.392404
dtype: float64</code></pre>
</div>
</div>
<ul>
<li><p>유의미한 변수가 한개도 없다..</p></li>
<li><p>그나마 p-value가 낮은, lag1, lag2만 포함시켜보자</p></li>
</ul>
<p><code>-</code> predict() : 데이터 집합을 인자로 전달해주지 않으면 훈련 데이터를 이용하여 예측을 수행</p>
<div class="cell" data-execution_count="298">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># step 1. x,y를 저장</span></span>
<span id="cb18-2"><a href="#cb18-2"></a></span>
<span id="cb18-3"><a href="#cb18-3"></a>X <span class="op">=</span> MS([<span class="st">"Lag1"</span>,<span class="st">"Lag2"</span>]).fit_transform(Smarket) </span>
<span id="cb18-4"><a href="#cb18-4"></a>y <span class="op">=</span> Smarket.Direction <span class="op">==</span> <span class="st">"Up"</span></span>
<span id="cb18-5"><a href="#cb18-5"></a></span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="co"># step 2.  모형 적합</span></span>
<span id="cb18-7"><a href="#cb18-7"></a></span>
<span id="cb18-8"><a href="#cb18-8"></a>glm <span class="op">=</span> sm.GLM(y,X , family <span class="op">=</span> sm.families.Binomial())</span>
<span id="cb18-9"><a href="#cb18-9"></a></span>
<span id="cb18-10"><a href="#cb18-10"></a><span class="co"># step 3. 모형에 대한 유의성 확인</span></span>
<span id="cb18-11"><a href="#cb18-11"></a>results <span class="op">=</span> glm.fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="299">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a>probs <span class="op">=</span> results.predict()</span>
<span id="cb19-2"><a href="#cb19-2"></a></span>
<span id="cb19-3"><a href="#cb19-3"></a>labels <span class="op">=</span> np.array([<span class="st">"Down"</span>]<span class="op">*</span><span class="dv">1250</span>)</span>
<span id="cb19-4"><a href="#cb19-4"></a>labels[probs <span class="op">&gt;</span> <span class="fl">0.5</span>] <span class="op">=</span> <span class="st">"Up"</span></span>
<span id="cb19-5"><a href="#cb19-5"></a>label <span class="op">=</span> [<span class="st">"Up"</span>,<span class="st">"Down"</span>]</span>
<span id="cb19-6"><a href="#cb19-6"></a></span>
<span id="cb19-7"><a href="#cb19-7"></a>confusion_table(labels, Smarket.Direction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="299">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Truth</th>
<th data-quarto-table-cell-role="th">Down</th>
<th data-quarto-table-cell-role="th">Up</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Predicted</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Down</td>
<td>114</td>
<td>102</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Up</td>
<td>488</td>
<td>546</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="데이터셋-분할" class="level3">
<h3 class="anchored" data-anchor-id="데이터셋-분할">데이터셋 분할</h3>
<p><code>-</code> 2005년 이전을 train, 이후를 test로 전환</p>
<div class="cell" data-execution_count="300">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a>train <span class="op">=</span> (Smarket.Year <span class="op">&lt;</span> <span class="dv">2005</span>)</span>
<span id="cb20-2"><a href="#cb20-2"></a>Smarket_train <span class="op">=</span> Smarket.loc[train]</span>
<span id="cb20-3"><a href="#cb20-3"></a>Smarket_test <span class="op">=</span> Smarket.loc[<span class="op">-</span>train]</span>
<span id="cb20-4"><a href="#cb20-4"></a></span>
<span id="cb20-5"><a href="#cb20-5"></a>X_train, X_test <span class="op">=</span> X.loc[train], X.loc[<span class="op">-</span>train]</span>
<span id="cb20-6"><a href="#cb20-6"></a>y_train, y_test <span class="op">=</span> y.loc[train], y.loc[<span class="op">-</span>train]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="모델-적합" class="level3">
<h3 class="anchored" data-anchor-id="모델-적합">모델 적합</h3>
<div class="cell" data-execution_count="302">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a>glm_train <span class="op">=</span> sm.GLM(y_train,</span>
<span id="cb21-2"><a href="#cb21-2"></a>                  X_train,</span>
<span id="cb21-3"><a href="#cb21-3"></a>                family<span class="op">=</span>sm.families.Binomial())</span>
<span id="cb21-4"><a href="#cb21-4"></a></span>
<span id="cb21-5"><a href="#cb21-5"></a>results <span class="op">=</span> glm_train.fit()</span>
<span id="cb21-6"><a href="#cb21-6"></a>probs <span class="op">=</span> results.predict(exog<span class="op">=</span>X_test)</span>
<span id="cb21-7"><a href="#cb21-7"></a>labels <span class="op">=</span> np.array([<span class="st">'Down'</span>]<span class="op">*</span><span class="dv">252</span>)</span>
<span id="cb21-8"><a href="#cb21-8"></a></span>
<span id="cb21-9"><a href="#cb21-9"></a>labels[probs <span class="op">&gt;</span><span class="fl">0.5</span>] <span class="op">=</span> <span class="st">'Up'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="304">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a>D <span class="op">=</span> Smarket.Direction</span>
<span id="cb22-2"><a href="#cb22-2"></a>L_train, L_test <span class="op">=</span> D.loc[train], D.loc[<span class="op">-</span>train]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="306">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a>np.mean(labels <span class="op">==</span> L_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="306">
<pre><code>0.5595238095238095</code></pre>
</div>
</div>
<div class="cell" data-execution_count="307">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1"></a>report <span class="op">=</span> classification_report(y_true <span class="op">=</span> L_test, y_pred <span class="op">=</span> labels,target_names<span class="op">=</span>label,output_dict<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb25-2"><a href="#cb25-2"></a>result_acc_logistic <span class="op">=</span> pd.DataFrame({<span class="st">"acc"</span> : [report[<span class="st">"accuracy"</span>]],</span>
<span id="cb25-3"><a href="#cb25-3"></a>                             <span class="st">"model"</span> : [<span class="st">"로지스틱"</span>]})</span>
<span id="cb25-4"><a href="#cb25-4"></a>result_acc_logistic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="307">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">acc</th>
<th data-quarto-table-cell-role="th">model</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.559524</td>
<td>로지스틱</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="309">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1"></a>result_logistic <span class="op">=</span> pd.DataFrame(report).<span class="op">\</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>                                    <span class="bu">eval</span>(<span class="st">"model = '로지스틱'"</span>)[[<span class="st">"Up"</span>,<span class="st">"model"</span>]].<span class="op">\</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>                                                reset_index().iloc[:<span class="op">-</span><span class="dv">1</span>,]</span>
<span id="cb26-4"><a href="#cb26-4"></a>result_logistic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="309">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th">Up</th>
<th data-quarto-table-cell-role="th">model</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>precision</td>
<td>0.500000</td>
<td>로지스틱</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>recall</td>
<td>0.315315</td>
<td>로지스틱</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>f1-score</td>
<td>0.386740</td>
<td>로지스틱</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../posts/2023-09-09-00. Linear Regression.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">00. Linear Regression</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../posts/study/2023-08-28-Extra 00. tidydata.html" class="pagination-link">
        <span class="nav-page-text">Extra 00. tidydata</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>